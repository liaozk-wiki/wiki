---
layout: post
title: 0x04:OGNL失效
category: bug
---

# 0x04OGNL失效

# 问题描述：

mybatis动态where中条件如下：

```xml
            <if test="dto.allDsr == 0">
                and 1 = 1
            </if>
            <if test="dto.allDsr == '0'">
                and 2 = 2
            </if>
            <if test='dto.allDsr == "0"'>
                and 3 = 3
            </if>
```



<br>



参数dto中allDsr是String类型的"0"。why 最终结果中有1=1，3=3 却没有2=2？

just debug：

![image-20250806160613564](https://cdn.jsdelivr.net/gh/liaozk-wiki/md_img/md/image-20250806160613564.png)



<br>



![image-20250806160712999](https://cdn.jsdelivr.net/gh/liaozk-wiki/md_img/md/image-20250806160712999.png)



<br>



![image-20250806160820904](https://cdn.jsdelivr.net/gh/liaozk-wiki/md_img/md/image-20250806160820904.png)

![image-20250806160912489](https://cdn.jsdelivr.net/gh/liaozk-wiki/md_img/md/image-20250806160912489.png)

![image-20250806161055214](https://cdn.jsdelivr.net/gh/liaozk-wiki/md_img/md/image-20250806161055214.png)

# dto.allDsr == 0 ：

![image-20250806161240865](https://cdn.jsdelivr.net/gh/liaozk-wiki/md_img/md/image-20250806161240865.png)

equal中会将其转换为double进行比较

![image-20250806161531012](https://cdn.jsdelivr.net/gh/liaozk-wiki/md_img/md/image-20250806161531012.png)

故满足表达式。



<br>



# dto.allDsr == '0'：

![image-20250806162011056](https://cdn.jsdelivr.net/gh/liaozk-wiki/md_img/md/image-20250806162011056.png)

注意v2是Character '0'



<br>



# dto.allDsr == "0"：

![image-20250806162313324](https://cdn.jsdelivr.net/gh/liaozk-wiki/md_img/md/image-20250806162313324.png)

V1 v2都是字符串"0"

<br>

OGNL比较中，有一方是数字就会将结果转换为数字再比较，否则直接比较，这里的坑就在于java是强类型，char与string。